<div class="flex flex-col h-full">
  <!-- Header -->
  <header
    class="bg-white/80 dark:bg-[#1a202e]/80 backdrop-blur-md px-8 py-6 border-b border-gray-100 dark:border-gray-800"
  >
    <div class="max-w-7xl mx-auto flex flex-col gap-6">
      <!-- Title & Subtitle -->
      <div class="flex items-center justify-between">
        <div>
          <h2 class="text-3xl font-bold text-[#111317] dark:text-white tracking-tight">
            Minhas Disciplinas
          </h2>
          <p class="text-[#646e87] dark:text-gray-400 mt-1">
            Gerencie suas matérias, faltas e desempenho.
          </p>
        </div>
      </div>

      <!-- Filters & Search -->
      <div class="flex flex-col md:flex-row gap-4 items-center justify-between">
        <!-- Search Bar -->
        <div class="relative w-full md:w-96">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <span class="material-symbols-outlined text-[#646e87]">search</span>
          </div>
          <input
            class="block w-full pl-10 pr-3 py-2.5 border-none rounded-xl bg-[#f0f1f4] dark:bg-gray-800 text-[#111317] dark:text-white placeholder-[#646e87] focus:ring-2 focus:ring-[#3f70e4]/50 text-sm transition-shadow shadow-sm"
            placeholder="Pesquisar por nome ou código..."
            type="text"
            (input)="onSearchChange($event)"
          />
        </div>

        <!-- Filter Chips -->
        <div class="flex gap-2 overflow-x-auto pb-1 w-full md:w-auto">
          <button
            (click)="setFilter('todas')"
            [class]="
              selectedFilter() === 'todas'
                ? 'whitespace-nowrap px-4 py-2 rounded-xl bg-[#111317] text-white text-sm font-medium shadow-md hover:bg-gray-800 transition-all'
                : 'whitespace-nowrap px-4 py-2 rounded-xl bg-white dark:bg-gray-800 text-[#646e87] dark:text-gray-300 border border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-all'
            "
          >
            Todas
          </button>
          <button
            (click)="setFilter('ativas')"
            [class]="
              selectedFilter() === 'ativas'
                ? 'whitespace-nowrap px-4 py-2 rounded-xl bg-[#111317] text-white text-sm font-medium shadow-md hover:bg-gray-800 transition-all'
                : 'whitespace-nowrap px-4 py-2 rounded-xl bg-white dark:bg-gray-800 text-[#646e87] dark:text-gray-300 border border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-all'
            "
          >
            Ativas
          </button>
          <button
            (click)="setFilter('este-semestre')"
            [class]="
              selectedFilter() === 'este-semestre'
                ? 'whitespace-nowrap px-4 py-2 rounded-xl bg-[#111317] text-white text-sm font-medium shadow-md hover:bg-gray-800 transition-all'
                : 'whitespace-nowrap px-4 py-2 rounded-xl bg-white dark:bg-gray-800 text-[#646e87] dark:text-gray-300 border border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-all'
            "
          >
            Este Semestre
          </button>
          <button
            (click)="setFilter('arquivadas')"
            [class]="
              selectedFilter() === 'arquivadas'
                ? 'whitespace-nowrap px-4 py-2 rounded-xl bg-[#111317] text-white text-sm font-medium shadow-md hover:bg-gray-800 transition-all'
                : 'whitespace-nowrap px-4 py-2 rounded-xl bg-white dark:bg-gray-800 text-[#646e87] dark:text-gray-300 border border-gray-100 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600 text-sm font-medium transition-all'
            "
          >
            Arquivadas
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Scrollable Content -->
  <div class="flex-1 overflow-y-auto px-8 py-8 bg-[#f0f1f4] dark:bg-[#0d1117]">
    <div class="max-w-7xl mx-auto grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6 pb-20">
      @for (disciplina of filteredDisciplinas(); track disciplina.id) {
        <div
          class="bg-white dark:bg-[#1a202e] rounded-2xl p-5 shadow-sm border border-transparent hover:border-[#3f70e4]/20 transition-all group relative overflow-hidden flex flex-col h-full"
        >
          <div [class]="'absolute top-0 left-0 w-1.5 h-full ' + getCorClass(disciplina.cor)"></div>

          <div class="flex justify-between items-start mb-3 pl-2">
            <span
              [class]="
                'text-xs font-bold px-2.5 py-1 rounded-lg uppercase tracking-wider ' +
                getCorBadgeClass(disciplina.cor)
              "
            >
              {{ disciplina.codigo }}
            </span>
            <div class="relative">
              <button
                class="text-gray-300 hover:text-[#111317] dark:hover:text-white transition-colors"
              >
                <span class="material-symbols-outlined text-[20px]">more_vert</span>
              </button>
            </div>
          </div>

          <div class="pl-2 mb-4 flex-1">
            <h3
              class="text-lg font-bold text-[#111317] dark:text-white leading-snug mb-1 group-hover:text-[#3f70e4] transition-colors"
            >
              {{ disciplina.nome }}
            </h3>
            <p class="text-sm text-[#646e87] dark:text-gray-400">{{ disciplina.professor }}</p>
          </div>

          <div class="pl-2 mt-auto">
            <div class="flex items-center justify-between mb-2">
              <span class="text-xs font-semibold text-[#646e87] dark:text-gray-400 uppercase"
                >Frequência</span
              >
              <span
                [class]="
                  'text-sm font-bold ' +
                  (disciplina.frequencia >= 80
                    ? 'text-green-600 dark:text-green-400'
                    : disciplina.frequencia >= 60
                      ? 'text-amber-600 dark:text-amber-400'
                      : 'text-rose-600 dark:text-rose-400')
                "
              >
                {{ disciplina.faltas }} Faltas
              </span>
            </div>

            <!-- Progress Bar -->
            <div class="w-full bg-gray-100 dark:bg-gray-800 rounded-full h-2 mb-5 overflow-hidden">
              <div
                [class]="
                  'h-2 rounded-full ' +
                  (disciplina.frequencia >= 80
                    ? 'bg-green-500'
                    : disciplina.frequencia >= 60
                      ? 'bg-amber-500'
                      : 'bg-rose-500')
                "
                [style.width.%]="disciplina.frequencia"
              ></div>
            </div>

            <div class="flex gap-2">
              <a
                [routerLink]="['/disciplinas', disciplina.id]"
                class="flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-[#3f70e4] text-white rounded-xl hover:bg-[#3562c5] transition-colors text-sm font-medium"
              >
                <span class="material-symbols-outlined text-[18px]">arrow_forward</span>
                Detalhes
              </a>
              <a
                [routerLink]="['/disciplinas', disciplina.id, 'edit']"
                class="px-4 py-2.5 bg-gray-100 dark:bg-gray-800 text-[#111317] dark:text-white rounded-xl hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors"
              >
                <span class="material-symbols-outlined text-[18px]">edit</span>
              </a>
            </div>
          </div>
        </div>
      } @empty {
        <div class="col-span-full flex flex-col items-center justify-center py-20 text-center">
          <div
            class="w-24 h-24 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center mb-6"
          >
            <span class="material-symbols-outlined text-5xl text-gray-400">book_2</span>
          </div>
          <h3 class="text-xl font-bold text-[#111317] dark:text-white mb-2">
            Nenhuma disciplina encontrada
          </h3>
          <p class="text-[#646e87] dark:text-gray-400 mb-6 max-w-md">
            @if (searchQuery()) {
              Não encontramos disciplinas que correspondam à sua busca. Tente outros termos.
            } @else {
              Você ainda não adicionou nenhuma disciplina. Clique no botão abaixo para começar!
            }
          </p>
          <a
            routerLink="/disciplinas/new"
            class="flex items-center gap-2 px-6 py-3 bg-[#3f70e4] text-white rounded-xl hover:bg-[#3562c5] transition-colors font-medium"
          >
            <span class="material-symbols-outlined">add</span>
            Adicionar Disciplina
          </a>
        </div>
      }

      <!-- Add Card Placeholder -->
      @if (filteredDisciplinas().length > 0) {
        <a
          routerLink="/disciplinas/new"
          class="bg-white/50 dark:bg-[#1a202e]/50 rounded-2xl p-5 border-2 border-dashed border-gray-300 dark:border-gray-700 hover:border-[#3f70e4] hover:bg-white dark:hover:bg-[#1a202e] transition-all flex flex-col items-center justify-center gap-4 min-h-[300px] group cursor-pointer"
        >
          <div
            class="w-16 h-16 bg-[#3f70e4]/10 rounded-full flex items-center justify-center group-hover:bg-[#3f70e4]/20 transition-colors"
          >
            <span class="material-symbols-outlined text-4xl text-[#3f70e4]">add</span>
          </div>
          <div class="text-center">
            <p class="font-bold text-[#111317] dark:text-white mb-1">Adicionar Disciplina</p>
            <p class="text-sm text-[#646e87] dark:text-gray-400">
              Clique para cadastrar uma nova matéria
            </p>
          </div>
        </a>
      }
    </div>
  </div>
</div>
